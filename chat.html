<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bubble Chat - Chat</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <h2 id="chatWith"></h2>
    </div>
    <div class="chat-box" id="chat-box"></div>
    <div class="chat-input">
      <input type="text" id="message" placeholder="Type a message...">
      <button id="sendBtn">Send</button>
    </div>
  </div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyB5C4PYCKfY9Rk7CVPNQ-JHX7iBF-DP4cE",
  authDomain: "bubblechat-8b913.firebaseapp.com",
  databaseURL: "https://bubblechat-8b913-default-rtdb.firebaseio.com",
  projectId: "bubblechat-8b913",
  storageBucket: "bubblechat-8b913.appspot.com",
  messagingSenderId: "890679022385",
  appId: "1:890679022385:web:0391f6e09e0efdaa661610"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Current user
const currentUser = localStorage.getItem('user');
const selectedUser = localStorage.getItem('chatWith');
document.getElementById('chatWith').innerText = selectedUser;

function getChatId(u1,u2){
  return [u1,u2].sort().join("_");
}

// Append message
function appendMessage(user, msg){
  const chatBox = document.getElementById('chat-box');
  const div = document.createElement('div');
  div.className = user===currentUser ? 'message self' : 'message other';
  div.textContent = msg || "";
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Send message
document.getElementById('sendBtn').addEventListener('click', function(){
  const msg = document.getElementById('message').value.trim();
  if(!msg) return;

  const chatId = getChatId(currentUser, selectedUser);
  const chatRef = db.ref('chats/' + chatId);

  chatRef.push({
    from: currentUser,
    message: msg,
    timestamp: Date.now()
  });

  document.getElementById('message').value = '';
});

// Load messages
const chatId = getChatId(currentUser, selectedUser);
const chatRef = db.ref('chats/' + chatId);
chatRef.on('child_added', snapshot => {
  const data = snapshot.val();
  if(data && data.message){
    appendMessage(data.from, data.message);
  }
});
</script>
</body>
</html>
